# Hue switch trigger for Away presence
- id: "1616991377860"
  alias: Going Out Switch Trigger
  description: Set presence to Away based upon front-door Hue switch trigger
  trigger:
    - device_id: c1a713c7d776a82491b262637fd8aa19
      domain: hue
      platform: device
      type: remote_button_long_release
      subtype: turn_off
  condition: []
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.presence
        option: Away
  mode: single

# Set HVAC mode to Eco 30 minutes after leaving.
- id: EcoHVACWhenLeaving
  alias: Eco_HVAC_When_Leaving
  description: Set thermostats to Eco 30 minutes after leaving
  trigger:
    - platform: state
      entity_id: input_select.presence
      to: Away
      for: 00:30:00
  action:
    - service: script.hvac_save_all_state_eco

# reset HVAC state when arriving.
- id: TurnHVACOnWhenArriving
  alias: Turn_HVAC_On_When_Arriving
  description: Turn HVAC back on when arriving
  trigger:
    - platform: state
      entity_id: input_select.presence
      from: Away
      to:
        - Home
        - With Guests
  action:
    - service: script.hvac_restore_all_state



# night time bedroom motion sensor
- id: TurnOffMotionMasterBedroom
  alias: Master Bedroom turn off motion
  trigger:
    at: 00:00:00
    platform: time
  condition:
    - condition: state
      entity_id: input_select.presence
      state:
        - Home
        - With Guests
  action:
    - service: switch.turn_off
      entity_id: switch.master_bedroom_motion_sensor

# night time guest room motion sensor
- id: TurnOffMotionGuestRoom
  alias: Guest Room turn off motion
  trigger:
    at: 00:00:00
    platform: time
  condition:
    - condition: state
      entity_id: input_select.presence
      state:
        - With Guests
  action:
    - service: switch.turn_off
      entity_id: switch.guest_room_motion_sensor

# smart wake up trigers.
# master bedroom Alexa alarm trigger.
- id: SmartWakeUpMasterBedroom
  alias: Smart Wake Up Master Bedroom
  trigger:
    - minutes: /5
      platform: time_pattern
  condition:
    - condition: time
      after: 02:00:00
      before: 09:00:00
    - condition: template
      value_template: "{{ state_attr('automation.smart_wake_up_master_bedroom', 'last_triggered').day != utcnow().day }}"
    - condition: template
      value_template: "{{ states('sensor.bedroom_next_alarm') != 'unavailable' and as_timestamp(states('sensor.bedroom_next_alarm')) - as_timestamp(now()) <= 3600 }}"
  action:
    - service: script.wake_up
      data:
        thermostat: master_bedroom
        warmer: master_bath_towel_warmer
        motion: master_bedroom_motion_sensor

# master bedroom fallback
- id: SmartWakeUpMasterBedroomFallback
  alias: Fallback time for Master Bedroom Wake-up sequence
  trigger:
    - at: 09:00:00
      platform: time
  condition:
    - condition: state
      entity_id: input_select.presence
      state:
        - Home
        - With Guests
    - condition: template
      value_template: "{{ state_attr('automation.smart_wake_up_master_bedroom', 'last_triggered').day != utcnow().day }}"
  action:
    - service: script.wake_up
      data:
        thermostat: master_bedroom
        warmer: master_bath_towel_warmer
        motion: master_bedroom_motion_sensor

# guest room alexa alarm trigger
- id: SmartWakeUpGuestRoom
  alias: Smart Wake Up Guest Room
  trigger:
    - minutes: /5
      platform: time_pattern
  condition:
    - condition: time
      after: 02:00:00
      before: 09:00:00
    - condition: template
      value_template: "{{ state_attr('automation.smart_wake_up_guest_room','last_triggered').day != utcnow().day }}"
    - condition: template
      value_template: "{{ states('sensor.guest_room_next_alarm') != 'unavailable' and as_timestamp(states('sensor.guest_room_next_alarm')) - as_timestamp(now()) <= 3600 }}"
  action:
    - service: script.wake_up
      data:
        thermostat: guest_room
        warmer: guest_bath_towel_warmer
        motion: guest_room_motion_sensor

# guest room fallback
- id: SmartWakeUpGuestRoomFallback
  alias: Fallback time for Guest Room Wake-up sequence
  trigger:
    - at: 09:00:00
      platform: time
  condition:
    - condition: state
      entity_id: input_select.presence
      state:
        - With Guests
    - condition: template
      value_template: "{{ state_attr('automation.smart_wake_up_guest_room','last_triggered').day != utcnow().day }}"
  action:
    - service: script.wake_up
      data:
        thermostat: guest_room
        warmer: guest_bath_towel_warmer
        motion: guest_room_motion_sensor
